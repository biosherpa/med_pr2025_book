---
title: "<span style ='font-size:40px; font-weight:bold;'>Ejercicios Práctica 9.  Construcción de intervalos de confianza alrededor de una proporción.</span>" 


author: "Jesús Martín Fernández"
format: 
  pdf:
    pdf-engine: pdflatex
    toc: false
    toc-title: "Contenidos"
    toc-location: left
editor: visual
---

Primero recupera la base de datos iam (df_iam2 Aula Virtual, Práctica 9), es un archivo.csv

```{r, eval=FALSE}
df_iam2 <- read.csv("df_iam2.csv")

head (df_iam2)
```

### 1. Intervalo de confianza alrededor de una proporción muestral.

Vamos a calcular el IC del 95% de la proporción de sujetos fumadores y no fumadores IC con el paquete Rbase (Método de Wald), creando la fórmula, nosotros mismos primero

```{r, eval=FALSE}
# Definir el nivel de significancia
alpha <- 0.05

# Crear tabla de frecuencias para la variable 'fum'
tabla_fum <- table(df_iam2$fum)

# Número total de observaciones
n <- sum(tabla_fum)

# Proporciones
p_fumadores <- tabla_fum["Sí"] / n
p_no_fumadores <- tabla_fum["No"] / n

# Cálculo del error estándar para fumadores (Sí)
SE_fumadores <- sqrt(p_fumadores * (1 - p_fumadores) / n)
z <- qnorm(1 - alpha / 2)  # Valor crítico para el nivel de confianza

# Cálculo del intervalo de confianza para fumadores (Sí)
IC_fumadores <- 
  c(p_fumadores - z * SE_fumadores, p_fumadores + z * SE_fumadores)

# Cálculo del error estándar para no fumadores (No)
SE_no_fumadores <- 
  sqrt(p_no_fumadores * (1 - p_no_fumadores) / n)

# Cálculo del intervalo de confianza para no fumadores (No)
IC_no_fumadores <- 
  c(p_no_fumadores - z * SE_no_fumadores, p_no_fumadores + z * SE_no_fumadores)

print(IC_fumadores)
print(IC_no_fumadores)

# Resultados (solo para que sea más fácil de leer)
print(paste("Proporción de fumadores (Sí):", round(p_fumadores, 4)))
print(paste("Intervalo de confianza (95%) para fumadores (Sí):", 
            round(IC_fumadores[1], 4), "a", round(IC_fumadores[2], 4)))

print(paste("Proporción de no fumadores (No):", round(p_no_fumadores, 4)))
print(paste("Intervalo de confianza (95%) para no fumadores (No):", 
            round(IC_no_fumadores[1], 4), "a", round(IC_no_fumadores[2], 4)))



```

Ahora lo haremos con la función `prop.test ()`

```{r, eval= FALSE}
# Extraer el número de fumadores (Sí) y no fumadores (No)
n_fumadores <- tabla_fum["Sí"]
n_no_fumadores <- tabla_fum["No"]

# Calcular intervalo de confianza para fumadores (Sí)
resultado_fumadores <- prop.test(n_fumadores, n, conf.level = 0.95)

# Calcular intervalo de confianza para no fumadores (No)
resultado_no_fumadores <- prop.test(n_no_fumadores, n, conf.level = 0.95)

# Imprimir los intervalos de confianza
print(resultado_fumadores$conf.int[1:2]) 
print(resultado_no_fumadores$conf.int[1:2])  
```

### 2. Representación gráfica de los intervalos de confianza (IC)

Vas a representar las proporciones de las categorías de la variable `imc_r`y sus IC del 95%. Analiza y utiliza el código siguiente,

```{r, eval=FALSE}

# Crear una tabla de frecuencias de la variable 'imc_r'
tabla_imc <- table(df_iam2$imc_r)

# Número total de observaciones
total_imc <- sum(tabla_imc)

# Calcular el intervalo de confianza para cada categoría
resultado_bajo <- prop.test(tabla_imc["Bajo"], total_imc, correct = FALSE)
resultado_normal <- prop.test(tabla_imc["Normal"], total_imc,
                              correct = FALSE)
resultado_obesidad <- 
  prop.test(tabla_imc["Obesidad"], total_imc, correct = FALSE)

# Graficar las proporciones con IC
# Ajustar los márgenes del gráfico
par(mar = c(5, 5, 2, 5))  
# Aumentar el margen inferior (5) y lateral izquierdo (5)
plot(c(resultado_bajo$estimate, 
       resultado_normal$estimate, resultado_obesidad$estimate), 
     xaxt = "n",        # Evitar etiquetas automáticas en x
     ylim = c(0, 0.8),      # Ajustar el límite  de y
     pch = 19,                       # Tipo de punto
     col = "darkblue",               # Color de los puntos
     xlab = "Categorías de IMC",    # Etiqueta del eje x
     ylab = "Proporción",            # Etiqueta del eje y
     main = "Proporciones de IMC con IC",  # Título
     cex = 1,                        # Tamaño de los puntos
     xlim = c(0.5, 3.5)              # Ajustar límite de eje x
)

# Añadir los nombres de las categorías en el eje x
axis(1, at = 1:3, labels = c("Bajo", "Normal", "Obesidad"))

# Añadir los intervalos de confianza para "Bajo"
arrows(
  x0 = 1, 
  y0 = resultado_bajo$conf.int[1], 
  y1 = resultado_bajo$conf.int[2], 
  angle = 90, 
  code = 3, 
  length = 0.1, 
  col = "blue"
)

# Añadir los intervalos de confianza para "Normal"
arrows(
  x0 = 2, 
  y0 = resultado_normal$conf.int[1], 
  y1 = resultado_normal$conf.int[2], 
  angle = 90, 
  code = 3, 
  length = 0.1, 
  col = "blue"
)

# Añadir los intervalos de confianza para "Obesidad"
arrows(
  x0 = 3, 
  y0 = resultado_obesidad$conf.int[1], 
  y1 = resultado_obesidad$conf.int[2], 
  angle = 90, 
  code = 3, 
  length = 0.1, 
  col = "blue"
)
```
